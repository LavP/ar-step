# 目的と作るもの

バリアフリーを意識して街を巡っていると、店内はバリアフリーの条件が整っているのに、入口の段差があるばっかりに利用できないというあと一歩の惜しいお店が多いと感じます。そんなお店に必要なのは、入り口にステップを置くということだけだったりします。しかし、ステップは高さや横幅を測る必要があり、またその寸法にフィットするものを探さなければなりません。これは労力がかかり、ステップが普及しない一つの壁になっていると考えます。私は、卒業制作を通してこの購入に至るまでが大変という問題を解決したいと思います。

そのためのアイデアとして、ARを使った計測を実現します。ARを用いて、スロープを設置したい場所の高さや横幅などを計測すると、得られた情報とステップのDBを照合して、条件にあったステップへの購入リンクを提示します。


# 制作するものの大枠

①、様々なステップの商品を、大きさのカテゴリで一覧で表示/検索できる情報ページ（WordPress）

②、上記サイトの検索クエリー（高さ横幅奥行き）をARを用いて生成できるARページ

③、横幅/奥行き/高さからマッチするステップを探し、かつ何個買えば横幅を埋めることが可能かを算出するアルゴリズムを制作しAPI化

# 制作技術と手法

①に関しては、WordPressを用いて各商品のシングルページを表示できるよにテーマを制作します。商品のデータはWordPressのカスタム投稿タイプとカスタムフィールドを使用して登録していきます。

②に関しては、8thWallというWebでARを行うことのできるライブラリを用いてARの土台を整備します。描画系として、8thWallと連携ができ、3Dを手軽に扱うことができるA-Frameライブラリを使用します。

まずは①を制作し、情報の閲覧ができる状態を作ります。また同時に情報量を増やします。情報の登録だけはWPテーマが完成していなくてもできるので、１日３ステップづつを目標として継続的にステップの情報を登録します。

WPテーマの制作は、既に５回フルで制作していますので、やり方は心得ています。

②に関しては、まだ情報も少なくチャレンジになりますが、8thWallのドキュメントを見て、できるとは考えていますので、早急に基礎となる動作ができるかを検証し、実装していきます。

②で横幅などを計測する手法としては、8thWallの機能の一つにraycast（衝突判定）があります。これを使用すると、カメラに写っている物体の3D上の座標を取得することが可能です。これを用いて２つの点間の距離や角度を三角関数などを用いて算出することで、取得が可能です。

デザインは細かな画面の遷移をデザインできる必要があるため、XDでは不向き
3D表現も可能なFramerなどのツールを検討する
デザインはSPファーストとする。

WordPressを制作する際は、プラグインでAMPやPWA対応ができるのでSEO的有利側面からも極力プラグインが対応できるカタチで投稿データを作る努力をする。（努力目標）

③に関しては、これを確定しないとWPでどのような情報を登録するかが決まってこない。速球にフローチャートを書く。

# AR検索の目標精度

誤差は1cm以内になるのが望ましい。
しかし、現状8thWallやARKit/ARCoreではそれは難しい。
ARの精度は、制作日現在のライブラリの精度に依存する。

基本的にはARKitやARCoreのほうが精度が高いことが予想される。
これを使用したいが、いま現在、これらのAPIはWebブラウザ向けには公開されていないため使用しない。もしも卒業制作期間中にこれらが開放されFlagも必要無い場合にのみ使用することとする。

いつでもARのコアライブラリを乗り換えができるよう、描画にはA-Frameを使用し汎用的な形をとる。


# サポートさせる環境

①情報サイト<br>
PC		IE11/Chrome最新/Safari12+/Firefox最新<br>
Android	AndroidWebView最新<br>
iOS/iPadOS	Safari12+/iOSWebViwe

②AR検索（8thWallを使用する場合）<br>
PC		非対応（QRコードを表示及び、数値手動入力ボックスを用意）<br>
Android	AndroidWebView最新<br>
iOS/iPadOS	Safari12+/iOSWebViwe

②AR検索（ARCore/ARKitを使用する場合）<br>
PC		非対応（QRコードを表示及び、数値手動入力ボックスを用意）<br>
Android	AndroidOreo以上でARCoreがインストール済みのデバイスでAndroidWebView最新<br>
iOS/iPadOS	iOS12以上でARKitが動作可能なSafari12+/iOSWebViwe


# スケジュール

１，③のアルゴリズムを完成させます（既に済）
２、WPのカスタム投稿タイプを定義し、ステップの登録を可能にします（既に済）
３、①のデザインを考えます（１１月初旬まで　進行中）
４、①のWPテーマを制作します（必要なテンプレートファイルの数はTOP/シングル１枚/アーカイブ１枚の計３枚ですので１１月中旬まで）

５、WordPressに投稿されたデータをRESTAPIもしくはWP_Queryで叩く際の入力値と返り値など連携に必要な情報を定義し、ダミークエリーを叩いて期待通りの結果が返ってくることを確認します。これによって①と②の連携を技術上可能にします。

６、8thWallを用いてraycastが実際に可能かを検証します（１１月末までに開始）
７、②のデザインを行います（１２月初旬まで）
８、A-frameを用いてページを構成します（ここが一番工数がかかるので１２月末まで）

９、②でとれた横幅などのデータと①の検索機能を繋げます

１０、余力があれば、グラフィックを制作するなどし拡散を試みます。
１１、余力があれば、WPのシングルページ上で、ステップをARプレビューして試し置きする機能を実装します。（QuickLookを使う場合はAppleの3Dフォーマットに沿ったオブジェクトをPHPを用いて生成する必要がある）

# 詳細なドキュメントと開発リポジトリ
ここには記載していない、詳細などはGitHubのreadmeに記述しています。https://github.com/LavP/ar-step

# ③のアルゴリズム
MATCHSTEPAPI
https://drive.google.com/file/d/1W09Ghfw_q0mOiHjbBG68rleekI0MqNu4/view?usp=sharing

